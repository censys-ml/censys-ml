data_dir = "${DATA_DIR}"

[sources.in]
  include = ["${IN_FILE}"]
  type = "${INPUT}"
  fingerprinting.fingerprint_bytes = 0
  fingerprinting.ignored_header_bytes = 0 
  fingerprinting.strategy = "checksum"
  start_at_beginning = true

[transforms.parser]
  inputs = ["in"]
  type   = "json_parser"
  field  = "message"
  drop_invalid = true

[transforms.lua]
  inputs = ['parser']
  type="lua"
  search_dirs = ['../scripts/lua']
  source= '''
require("general_field")
require("string_field")
require("numeric_field")

handle_string(event)
handle_numeric(event)
handle_general(event)
'''

[sinks.out]
  inputs = ["lua"] 
  type = "${OUTPUT}"
  encoding.codec = "ndjson"
  path = "${OUT_FILE}"